<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Excelæ•°æ®ç”Ÿæˆå™¨</title>
    <script src="https://cdn.sheetjs.com/xlsx-0.20.1/package/dist/xlsx.full.min.js"></script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500&display=swap" rel="stylesheet">
    <style>
        #previewTable th, #previewTable td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }

        #previewTable th {
            background-color: #f5f5f5;
        }

        #previewTable tr:nth-child(even) {
            background-color: #f9f9f9;
        }

        #previewTable tr:hover {
            background-color: #f5f5f5;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: 'Roboto', Arial, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px;
            background-color: #f5f7fa;
            color: #2c3e50;
        }

        h1 {
            text-align: center;
            color: #34495e;
            margin-bottom: 40px;
            font-weight: 500;
            font-size: 2.5em;
        }

        .upload-section {
            background: white;
            margin: 50px auto;
            padding: 50px;
            border-radius: 15px;
            box-shadow: 0 4px 15px rgba(0, 0, 0, 0.1);
            text-align: center;
            transition: transform 0.3s ease;
            border: 3px dashed #3498db;
            width: 80%;
            max-width: 800px;
        }

        .upload-section.drag-over {
            background-color: #f8f9fa;
            border-color: #2ecc71;
        }

        .upload-section .upload-icon {
            font-size: 48px;
            color: #3498db;
            margin-bottom: 20px;
        }

        .upload-section:hover {
            transform: translateY(-5px);
        }

        .upload-section input[type="file"] {
            display: none;
        }

        .upload-button {
            display: inline-block;
            padding: 12px 24px;
            background-color: #3498db;
            color: white;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s ease;
            font-size: 1.1em;
        }

        .upload-button:hover {
            background-color: #2980b9;
        }

        .fields-section {
            background: white;
            padding: 30px;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .field-config {
            background: #f8f9fa;
            margin-bottom: 20px;
            padding: 20px;
            border-radius: 10px;
            transition: all 0.3s ease;
        }

        .field-config:hover {
            transform: translateX(5px);
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .field-config h3 {
            color: #2c3e50;
            margin-bottom: 15px;
            font-weight: 500;
        }

        .field-row {
            display: flex;
            gap: 20px;
            margin-bottom: 15px;
            align-items: center;
        }

        .field-row label {
            min-width: 100px;
            color: #7f8c8d;
        }

        select, input[type="text"], input[type="number"] {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #dcdfe6;
            border-radius: 6px;
            font-size: 14px;
            transition: border-color 0.3s ease;
        }

        select:focus, input:focus {
            outline: none;
            border-color: #3498db;
        }

        .generate-section {
            margin-top: 30px;
            text-align: center;
        }

        .row-count-input {
            margin-bottom: 20px;
            text-align: center;
        }

        .row-count-input label {
            display: block;
            margin-bottom: 10px;
            color: #7f8c8d;
        }

        .row-count-input input {
            width: 200px;
            text-align: center;
        }

        button {
            padding: 12px 30px;
            background-color: #2ecc71;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1em;
            transition: all 0.3s ease;
        }

        button:hover {
            background-color: #27ae60;
            transform: translateY(-2px);
        }

        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(255, 255, 255, 0.9);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
        }

        .loading.active {
            display: flex;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #3498db;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .field-row input[type="checkbox"] {
            width: auto;
            padding: 0;
            margin-right: 5px;
        }
        
        .field-row .checkbox-info {
            color: #7f8c8d;
            font-size: 12px;
            margin-left: 5px;
        }

        .distribution-field {
            background-color: #f0f7ff;
            padding: 10px;
            border-radius: 5px;
            margin-bottom: 15px;
            border-left: 3px solid #3498db;
        }

        .multi-separator-field {
            background-color: #f0fff7;
            padding: 10px;
            border-radius: 5px;
            border-left: 3px solid #2ecc71;
        }

        .options-container {
            display: flex;
            flex-direction: column;
            width: 100%;
        }

        .option-buttons {
            margin-bottom: 10px;
        }

        .add-option-btn {
            background-color: #3498db;
            color: white;
            border: none;
            padding: 5px 10px;
            border-radius: 4px;
            cursor: pointer;
            font-size: 0.9em;
        }

        .add-option-btn:hover {
            background-color: #2980b9;
        }

        .options-inputs {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .option-input-row {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-input {
            flex: 1;
            padding: 8px;
            border: 1px solid #dcdfe6;
            border-radius: 4px;
        }

        .remove-option-btn {
            background-color: #e74c3c;
            color: white;
            border: none;
            width: 24px;
            height: 24px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            padding: 0;
            line-height: 1;
        }

        .remove-option-btn:hover {
            background-color: #c0392b;
        }
    </style>
</head>
<body>
    <h1>Excelæ•°æ®ç”Ÿæˆå™¨</h1>
    
    <div class="upload-section" id="dropZone">
        <div class="upload-icon">ğŸ“</div>
        <label class="upload-button" for="excelFile">
            <span>é€‰æ‹©Excelæ–‡ä»¶</span>
            <input type="file" id="excelFile" accept=".xlsx,.xls" />
        </label>
        <p style="margin-top: 15px; color: #7f8c8d;">æ”¯æŒ.xlsxå’Œ.xlsæ ¼å¼æ–‡ä»¶<br>ç‚¹å‡»é€‰æ‹©æˆ–æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„</p>
    </div>

    <div id="fieldsContainer" class="fields-section" style="display: none;">
        <h2 style="margin-bottom: 30px; color: #34495e;">å­—æ®µé…ç½®</h2>
        <div id="fieldsList"></div>
        
        <div class="generate-section">
            <div class="row-count-input">
                <label>ç”Ÿæˆæ•°æ®è¡Œæ•°ï¼š</label>
                <input type="number" id="rowCount" value="100" min="1" max="10000" />
            </div>
            <button onclick="previewData()">é¢„è§ˆæ•°æ®</button>
            <button onclick="generateData()">ç”ŸæˆExcel</button>
        </div>
        <div id="previewContainer" style="display: none; margin-top: 20px;">
            <h3>æ•°æ®é¢„è§ˆ</h3>
            <div style="overflow-x: auto;">
                <table id="previewTable" style="width: 100%; border-collapse: collapse; margin-top: 10px;">
                    <thead></thead>
                    <tbody></tbody>
                </table>
            </div>
        </div>
    </div>

    <div class="loading">
        <div class="loading-spinner"></div>
    </div>

    <script>
        let workbook = null;
        let fields = [];

        document.getElementById('excelFile').addEventListener('change', function(e) {
            const file = e.target.files[0];
            if (!file) return;

            const loading = document.querySelector('.loading');
            loading.classList.add('active');

            const reader = new FileReader();

            reader.onload = function(e) {
                const data = new Uint8Array(e.target.result);
                workbook = XLSX.read(data, {type: 'array'});
                
                const firstSheet = workbook.Sheets[workbook.SheetNames[0]];
                const jsonData = XLSX.utils.sheet_to_json(firstSheet, {header: 1});
                
                fields = jsonData[0];
                displayFields(fields);
                loading.classList.remove('active');
            };

            reader.onerror = function() {
                alert('æ–‡ä»¶è¯»å–å¤±è´¥ï¼Œè¯·é‡è¯•');
                loading.classList.remove('active');
            };

            reader.readAsArrayBuffer(file);
        });

        function displayFields(fields) {
            const container = document.getElementById('fieldsList');
            container.innerHTML = '';
            
            fields.forEach(field => {
                const fieldDiv = document.createElement('div');
                fieldDiv.className = 'field-config';
                
                // å…ˆåˆ›å»ºå®Œæ•´çš„HTMLç»“æ„
                fieldDiv.innerHTML = `
                    <h3>${field}</h3>
                    <div class="field-row">
                        <label>æ•°æ®ç±»å‹ï¼š</label>
                        <select id="type_${field}" onchange="updateFieldVisibility('${field}')">
                            <option value="text">æ–‡æœ¬</option>
                            <option value="number">æ•°å­—</option>
                            <option value="date">æ—¥æœŸ</option>
                            <option value="boolean">å¸ƒå°”å€¼</option>
                            <option value="email">ç”µå­é‚®ä»¶</option>
                            <option value="phone">æ‰‹æœºå·ç </option>
                            <option value="address">åœ°å€</option>
                        </select>
                    </div>
                    <div class="field-row distribution-field" id="distribution_row_${field}">
                        <label>åˆ†å¸ƒç±»å‹ï¼š</label>
                        <select id="distribution_${field}">
                            <option value="uniform">å‡åŒ€åˆ†å¸ƒ</option>
                            <option value="normal">æ­£æ€åˆ†å¸ƒ</option>
                            <option value="exponential">æŒ‡æ•°åˆ†å¸ƒ</option>
                            <option value="poisson">æ³Šæ¾åˆ†å¸ƒ</option>
                            <option value="binomial">äºŒé¡¹åˆ†å¸ƒ</option>
                            <option value="geometric">å‡ ä½•åˆ†å¸ƒ</option>
                            <option value="lognormal">å¯¹æ•°æ­£æ€åˆ†å¸ƒ</option>
                            <option value="pareto">å¸•ç´¯æ‰˜åˆ†å¸ƒ</option>
                            <option value="gamma">ä¼½é©¬åˆ†å¸ƒ</option>
                            <option value="beta">è´å¡”åˆ†å¸ƒ</option>
                        </select>
                    </div>
                    <div class="field-row">
                        <label>æ˜¯å¦å¤šé€‰ï¼š</label>
                        <input type="checkbox" id="multi_${field}" style="width: auto; margin-right: 5px;">
                        <span class="checkbox-info">(å¤šé€‰æ—¶å°†éšæœºç”Ÿæˆ1-nä¸ªä¸é‡å¤å€¼)</span>
                    </div>
                    <div class="field-row multi-separator-field" id="multi_separator_row_${field}" style="display: none;">
                        <label>å¤šé€‰åˆ†éš”ç¬¦ï¼š</label>
                        <input type="text" id="multi_separator_${field}" placeholder="å¤šé€‰å€¼ä¹‹é—´çš„åˆ†éš”ç¬¦" value="|" />
                    </div>
                    <div class="field-row number-field" id="min_row_${field}">
                        <label>æœ€å°å€¼ï¼š</label>
                        <input type="text" id="min_${field}" placeholder="è¯·è¾“å…¥æœ€å°å€¼" />
                    </div>
                    <div class="field-row number-field" id="max_row_${field}">
                        <label>æœ€å¤§å€¼ï¼š</label>
                        <input type="text" id="max_${field}" placeholder="è¯·è¾“å…¥æœ€å¤§å€¼" />
                    </div>
                    <div class="field-row number-field" id="decimal_row_${field}">
                        <label>å°æ•°ç‚¹è®¾ç½®ï¼š</label>
                        <select id="decimal_${field}">
                            <option value="auto">è‡ªåŠ¨(æ ¹æ®åˆ†å¸ƒç±»å‹)</option>
                            <option value="0">æ— å°æ•°ç‚¹</option>
                            <option value="1">ä¿ç•™1ä½å°æ•°</option>
                            <option value="2">ä¿ç•™2ä½å°æ•°</option>
                            <option value="3">ä¿ç•™3ä½å°æ•°</option>
                            <option value="4">ä¿ç•™4ä½å°æ•°</option>
                        </select>
                    </div>
                    <div class="field-row text-field" id="text_range_row_${field}" style="display: none;">
                        <label>å¯é€‰å€¼ï¼š</label>
                        <div class="options-container" id="text_options_${field}">
                            <div class="option-buttons">
                                <button type="button" class="add-option-btn" onclick="addOptionInput('${field}', 'text')">æ·»åŠ é€‰é¡¹</button>
                            </div>
                            <div class="options-inputs" id="text_inputs_${field}">
                                <div class="option-input-row">
                                    <input type="text" class="option-input" placeholder="è¯·è¾“å…¥é€‰é¡¹å€¼"/>
                                    <button type="button" class="remove-option-btn" onclick="removeOptionInput(this)">Ã—</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="field-row email-field" id="email_suffix_row_${field}" style="display: none;">
                        <label>é‚®ç®±åç¼€ï¼š</label>
                        <div class="options-container" id="email_options_${field}">
                            <div class="option-buttons">
                                <button type="button" class="add-option-btn" onclick="addOptionInput('${field}', 'email')">æ·»åŠ åç¼€</button>
                            </div>
                            <div class="options-inputs" id="email_inputs_${field}">
                                <div class="option-input-row">
                                    <input type="text" class="option-input" placeholder="è¯·è¾“å…¥é‚®ç®±åç¼€ï¼Œå¦‚ï¼šgmail.com"/>
                                    <button type="button" class="remove-option-btn" onclick="removeOptionInput(this)">Ã—</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="field-row address-field" id="provinces_row_${field}" style="display: none;">
                        <label>çœä»½ï¼š</label>
                        <div class="options-container" id="provinces_options_${field}">
                            <div class="option-buttons">
                                <button type="button" class="add-option-btn" onclick="addOptionInput('${field}', 'province')">æ·»åŠ çœä»½</button>
                            </div>
                            <div class="options-inputs" id="province_inputs_${field}">
                                <div class="option-input-row">
                                    <input type="text" class="option-input" placeholder="è¯·è¾“å…¥çœä»½"/>
                                    <button type="button" class="remove-option-btn" onclick="removeOptionInput(this)">Ã—</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="field-row address-field" id="cities_row_${field}" style="display: none;">
                        <label>åŸå¸‚ï¼š</label>
                        <div class="options-container" id="cities_options_${field}">
                            <div class="option-buttons">
                                <button type="button" class="add-option-btn" onclick="addOptionInput('${field}', 'city')">æ·»åŠ åŸå¸‚</button>
                            </div>
                            <div class="options-inputs" id="city_inputs_${field}">
                                <div class="option-input-row">
                                    <input type="text" class="option-input" placeholder="è¯·è¾“å…¥åŸå¸‚"/>
                                    <button type="button" class="remove-option-btn" onclick="removeOptionInput(this)">Ã—</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="field-row address-field" id="districts_row_${field}" style="display: none;">
                        <label>åŒºåŸŸï¼š</label>
                        <div class="options-container" id="districts_options_${field}">
                            <div class="option-buttons">
                                <button type="button" class="add-option-btn" onclick="addOptionInput('${field}', 'district')">æ·»åŠ åŒºåŸŸ</button>
                            </div>
                            <div class="options-inputs" id="district_inputs_${field}">
                                <div class="option-input-row">
                                    <input type="text" class="option-input" placeholder="è¯·è¾“å…¥åŒºåŸŸ"/>
                                    <button type="button" class="remove-option-btn" onclick="removeOptionInput(this)">Ã—</button>
                                </div>
                            </div>
                        </div>
                    </div>
                `;
                container.appendChild(fieldDiv);

                // åœ¨å…ƒç´ æ·»åŠ åˆ°DOMåè®¾ç½®åˆå§‹å¯è§æ€§
                const selectElement = document.getElementById(`type_${field}`);
                // è®¾ç½®é»˜è®¤ç±»å‹ä¸ºæ–‡æœ¬
                selectElement.value = "text";
                updateFieldVisibility(field);
                
                // ä¸ºå¤šé€‰å¤é€‰æ¡†æ·»åŠ äº‹ä»¶ç›‘å¬å™¨
                const multiCheckbox = document.getElementById(`multi_${field}`);
                multiCheckbox.addEventListener('change', () => {
                    updateFieldVisibility(field);
                });
            });

            document.getElementById('fieldsContainer').style.display = 'block';
        }

        // æ·»åŠ æ–°çš„å‡½æ•°æ¥å¤„ç†å­—æ®µå¯è§æ€§
        function updateFieldVisibility(field) {
            const type = document.getElementById(`type_${field}`).value;
            const numberFields = document.querySelectorAll(`#min_row_${field}, #max_row_${field}, #decimal_row_${field}`);
            const textField = document.getElementById(`text_range_row_${field}`);
            const emailField = document.getElementById(`email_suffix_row_${field}`);
            const addressFields = document.querySelectorAll(`#provinces_row_${field}, #cities_row_${field}, #districts_row_${field}`);
            const distributionField = document.getElementById(`distribution_row_${field}`);
            const multiSeparatorField = document.getElementById(`multi_separator_row_${field}`);

            // éšè—æ‰€æœ‰å­—æ®µ
            numberFields.forEach(el => el.style.display = 'none');
            textField.style.display = 'none';
            emailField.style.display = 'none';
            addressFields.forEach(el => el.style.display = 'none');

            // æ£€æŸ¥æ˜¯å¦å¼€å¯å¤šé€‰
            const isMulti = document.getElementById(`multi_${field}`).checked;
            multiSeparatorField.style.display = isMulti ? 'flex' : 'none';

            // æ‰€æœ‰ç±»å‹éƒ½æ˜¾ç¤ºåˆ†å¸ƒç±»å‹
            distributionField.style.display = 'flex';

            // æ ¹æ®ç±»å‹æ˜¾ç¤ºç›¸åº”å­—æ®µ
            switch(type) {
                case 'number':
                case 'date':
                    numberFields.forEach(el => el.style.display = 'flex');
                    break;
                case 'text':
                    textField.style.display = 'flex';
                    break;
                case 'email':
                    emailField.style.display = 'flex';
                    break;
                case 'address':
                    addressFields.forEach(el => el.style.display = 'flex');
                    break;
            }
        }

        function generateRandomValue(type, min, max, field, isMulti, decimal) {
            const chars = 'abcdefghijklmnopqrstuvwxyz0123456789';
            const distribution = document.getElementById(`distribution_${field}`).value;
            const multiSeparator = document.getElementById(`multi_separator_${field}`).value || '|';
            
            // æ ¹æ®åˆ†å¸ƒè·å–é€‰é¡¹ç´¢å¼•
            const getDistributedIndex = (array) => {
                if (!array || array.length === 0) return 0;
                // ä½¿ç”¨åˆ†å¸ƒç±»å‹å½±å“é€‰æ‹©æ¦‚ç‡
                if (distribution === 'uniform') {
                    // å‡åŒ€åˆ†å¸ƒ - æ¯ä¸ªé€‰é¡¹æ¦‚ç‡ç›¸åŒ
                    return Math.floor(Math.random() * array.length);
                } else {
                    // å…¶ä»–åˆ†å¸ƒ - ä½¿ç”¨åˆ†å¸ƒå‡½æ•°ç”Ÿæˆçš„å€¼æ¥é€‰æ‹©ç´¢å¼•
                    const index = Math.floor(generateDistributedNumber(
                        distribution, 
                        0, 
                        array.length - 1,
                        1, 0, 1, 10, 0.5, 2, 2,
                        '0' // å¼ºåˆ¶ä½¿ç”¨æ•´æ•°ç´¢å¼•
                    ));
                    return Math.max(0, Math.min(array.length - 1, index));
                }
            };
            
            // è·å–å¯é€‰å€¼æ•°ç»„ï¼ˆæ ¹æ®ç±»å‹ï¼‰
            const getOptionsArray = () => {
                switch(type) {
                    case 'number':
                        min = parseFloat(min) || 0;
                        max = parseFloat(max) || 100;
                        // å¯¹äºæ•°å­—ï¼Œåˆ›å»ºä¸€ä¸ªå¯èƒ½çš„å€¼èŒƒå›´
                        const range = [];
                        // æ ¹æ®åˆ†å¸ƒç±»å‹ç”Ÿæˆä¸åŒçš„æ•°å€¼
                        for(let i = 0; i < 30; i++) { // ç”Ÿæˆè¶³å¤Ÿå¤šçš„ä¸åŒå€¼ä½œä¸ºå¯é€‰é¡¹
                            range.push(generateDistributedNumber(distribution, min, max, 1, 0, 1, 10, 0.5, 2, 2, decimal));
                        }
                        // å»é‡
                        return [...new Set(range)];
                    case 'text':
                        const textOptions = getOptionValues(field, 'text');
                        return textOptions.length > 0 ? 
                            textOptions : ['ç¤ºä¾‹æ–‡æœ¬1', 'ç¤ºä¾‹æ–‡æœ¬2', 'ç¤ºä¾‹æ–‡æœ¬3'];
                    case 'date':
                        // å¯¹äºæ—¥æœŸï¼Œæ ¹æ®åˆ†å¸ƒç”Ÿæˆæ—¥æœŸå€¼
                        const startDate = min ? new Date(min) : new Date('2020-01-01');
                        const endDate = max ? new Date(max) : new Date();
                        const startTime = startDate.getTime();
                        const endTime = endDate.getTime();
                        
                        const dateRange = [];
                        for(let i = 0; i < 30; i++) {
                            // ä½¿ç”¨åˆ†å¸ƒç”Ÿæˆæ¯”ä¾‹å€¼(0-1)ï¼Œç„¶åè½¬æ¢ä¸ºæ—¶é—´æˆ³
                            const ratio = generateDistributedNumber(distribution, 0, 100, 1, 0, 1, 10, 0.5, 2, 2, '2') / 100;
                            const timestamp = startTime + ratio * (endTime - startTime);
                            dateRange.push(new Date(timestamp).toISOString().split('T')[0]);
                        }
                        // å»é‡
                        return [...new Set(dateRange)];
                    case 'boolean':
                        return [true, false];
                    case 'email':
                        // ç”Ÿæˆä¸€äº›ä¸åŒçš„é‚®ç®±ä½œä¸ºå¯é€‰å€¼
                        const emailOptions = [];
                        const emailDomains = getOptionValues(field, 'email');
                        const availableDomains = emailDomains.length > 0 ? 
                            emailDomains : ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', '163.com'];
                        
                        for(let i = 0; i < 10; i++) {
                            const username = Array.from({length: 8}, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
                            emailOptions.push(`${username}@${availableDomains[getDistributedIndex(availableDomains)]}`);
                        }
                        return emailOptions;
                    case 'phone':
                        const prefixes = ['130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '150', '151', '152'];
                        // ç”Ÿæˆä¸€äº›ä¸åŒçš„æ‰‹æœºå·ä½œä¸ºå¯é€‰å€¼
                        const phones = [];
                        for(let i = 0; i < 10; i++) {
                            const prefix = prefixes[getDistributedIndex(prefixes)];
                            const suffix = Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
                            phones.push(prefix + suffix);
                        }
                        return phones;
                    case 'address':
                        // ç”Ÿæˆä¸€äº›ä¸åŒçš„åœ°å€ä½œä¸ºå¯é€‰å€¼
                        const addresses = [];
                        const provinceOpts = getOptionValues(field, 'province');
                        const cityOpts = getOptionValues(field, 'city');
                        const districtOpts = getOptionValues(field, 'district');
                        
                        const availableProvinces = provinceOpts.length > 0 ? 
                            provinceOpts : ['åŒ—äº¬å¸‚', 'ä¸Šæµ·å¸‚', 'å¹¿ä¸œçœ', 'æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ'];
                        const availableCities = cityOpts.length > 0 ? 
                            cityOpts : ['å¸‚è¾–åŒº', 'å—äº¬å¸‚', 'æ­å·å¸‚', 'å¹¿å·å¸‚', 'æ·±åœ³å¸‚'];
                        const availableDistricts = districtOpts.length > 0 ? 
                            districtOpts : ['æœé˜³åŒº', 'æµ·æ·€åŒº', 'æµ¦ä¸œæ–°åŒº', 'ç¦ç”°åŒº', 'å§‘è‹åŒº'];
                        
                        for(let i = 0; i < Math.min(availableProvinces.length * availableCities.length, 10); i++) {
                            addresses.push(
                                `${availableProvinces[getDistributedIndex(availableProvinces)]}` +
                                `${availableCities[getDistributedIndex(availableCities)]}` +
                                `${availableDistricts[getDistributedIndex(availableDistricts)]}`
                            );
                        }
                        return addresses;
                    default:
                        return [''];
                }
            };
            
            // å•ä¸ªå€¼ç”Ÿæˆå‡½æ•°
            const generateSingleValue = () => {
                switch(type) {
                    case 'number':
                        min = parseFloat(min) || 0;
                        max = parseFloat(max) || 100;
                        // ä½¿ç”¨åˆ†å¸ƒå‡½æ•°ç”Ÿæˆæ•°å€¼
                        return generateDistributedNumber(distribution, min, max, 1, 0, 1, 10, 0.5, 2, 2, decimal);
                    case 'text':
                        const textValues = getOptionValues(field, 'text');
                        const availableTexts = textValues.length > 0 ? 
                            textValues : ['ç¤ºä¾‹æ–‡æœ¬1', 'ç¤ºä¾‹æ–‡æœ¬2', 'ç¤ºä¾‹æ–‡æœ¬3'];
                        return availableTexts[getDistributedIndex(availableTexts)];
                    case 'date':
                        const startDate = min ? new Date(min) : new Date('2020-01-01');
                        const endDate = max ? new Date(max) : new Date();
                        const startTime = startDate.getTime();
                        const endTime = endDate.getTime();
                        
                        // ä½¿ç”¨åˆ†å¸ƒç”Ÿæˆæ¯”ä¾‹å€¼(0-1)ï¼Œç„¶åè½¬æ¢ä¸ºæ—¶é—´æˆ³
                        const ratio = generateDistributedNumber(distribution, 0, 100, 1, 0, 1, 10, 0.5, 2, 2, '2') / 100;
                        const timestamp = startTime + ratio * (endTime - startTime);
                        return new Date(timestamp).toISOString().split('T')[0];
                    case 'boolean':
                        // å¯¹äºå¸ƒå°”å€¼ï¼Œå¯ä»¥æ ¹æ®åˆ†å¸ƒå½±å“true/falseçš„æ¦‚ç‡
                        if (distribution === 'uniform') {
                            return Math.random() < 0.5; // å‡åŒ€åˆ†å¸ƒï¼Œ50%çš„æ¦‚ç‡
                        } else {
                            // å…¶ä»–åˆ†å¸ƒä½¿ç”¨ç”Ÿæˆçš„å€¼æ¥ç¡®å®šæ¦‚ç‡
                            const value = generateDistributedNumber(distribution, 0, 100, 1, 0, 1, 10, 0.5, 2, 2, '2') / 100;
                            return value < 0.5;
                        }
                    case 'email':
                        const emailDomainsForSingle = getOptionValues(field, 'email');
                        const availableDomainsForSingle = emailDomainsForSingle.length > 0 ? 
                            emailDomainsForSingle : ['gmail.com', 'yahoo.com', 'hotmail.com', 'outlook.com', '163.com'];
                        const usernameForSingle = Array.from({length: 8}, () => chars.charAt(Math.floor(Math.random() * chars.length))).join('');
                        return `${usernameForSingle}@${availableDomainsForSingle[getDistributedIndex(availableDomainsForSingle)]}`;
                    case 'phone':
                        const prefixes = ['130', '131', '132', '133', '134', '135', '136', '137', '138', '139', '150', '151', '152'];
                        const prefix = prefixes[getDistributedIndex(prefixes)];
                        const suffix = Math.floor(Math.random() * 100000000).toString().padStart(8, '0');
                        return prefix + suffix;
                    case 'address':
                        const provinceOptsForSingle = getOptionValues(field, 'province');
                        const cityOptsForSingle = getOptionValues(field, 'city');
                        const districtOptsForSingle = getOptionValues(field, 'district');
                        
                        const availableProvincesForSingle = provinceOptsForSingle.length > 0 ? 
                            provinceOptsForSingle : ['åŒ—äº¬å¸‚', 'ä¸Šæµ·å¸‚', 'å¹¿ä¸œçœ', 'æ±Ÿè‹çœ', 'æµ™æ±Ÿçœ'];
                        const availableCitiesForSingle = cityOptsForSingle.length > 0 ? 
                            cityOptsForSingle : ['å¸‚è¾–åŒº', 'å—äº¬å¸‚', 'æ­å·å¸‚', 'å¹¿å·å¸‚', 'æ·±åœ³å¸‚'];
                        const availableDistrictsForSingle = districtOptsForSingle.length > 0 ? 
                            districtOptsForSingle : ['æœé˜³åŒº', 'æµ·æ·€åŒº', 'æµ¦ä¸œæ–°åŒº', 'ç¦ç”°åŒº', 'å§‘è‹åŒº'];
                        
                        return (
                            `${availableProvincesForSingle[getDistributedIndex(availableProvincesForSingle)]}` +
                            `${availableCitiesForSingle[getDistributedIndex(availableCitiesForSingle)]}` +
                            `${availableDistrictsForSingle[getDistributedIndex(availableDistrictsForSingle)]}`
                        );
                    default:
                        return '';
                }
            };

            // å¦‚æœæ˜¯å¤šé€‰ï¼Œéšæœºç”Ÿæˆ1-nä¸ªå€¼å¹¶ç”¨è‡ªå®šä¹‰åˆ†éš”ç¬¦è¿æ¥
            if (isMulti) {
                const options = getOptionsArray();
                // æœ€å¤šå¯é€‰çš„æ•°é‡
                const maxOptions = options.length;
                // æ ¹æ®åˆ†å¸ƒç±»å‹é€‰æ‹©æ•°é‡
                let count;
                if (distribution === 'uniform') {
                    // å‡åŒ€åˆ†å¸ƒ - 1åˆ°maxOptionsä¹‹é—´éšæœºé€‰æ‹©
                    count = Math.floor(Math.random() * maxOptions) + 1;
                } else {
                    // ä½¿ç”¨åˆ†å¸ƒå‡½æ•°ç”Ÿæˆçš„å€¼æ¥ç¡®å®šæ•°é‡ (1åˆ°maxOptionsä¹‹é—´)
                    count = Math.floor(generateDistributedNumber(distribution, 1, Math.max(1, maxOptions), 1, 0, 1, 10, 0.5, 2, 2, '0'));
                }
                count = Math.min(count, maxOptions); // ç¡®ä¿ä¸è¶…è¿‡å¯ç”¨é€‰é¡¹æ•°
                
                // éšæœºæ‰“ä¹±æ•°ç»„å¹¶å–å‰countä¸ªå…ƒç´ 
                // æŒ‰ç…§åˆ†å¸ƒæ¥é€‰æ‹©å…ƒç´ ï¼Œè€Œä¸æ˜¯ç®€å•åœ°æ’åº
                const selected = [];
                const usedIndices = new Set();
                
                // å°½é‡é€‰æ‹©ä¸åŒçš„å…ƒç´ 
                for (let i = 0; i < count && selected.length < options.length; i++) {
                    // ä½¿ç”¨åˆ†å¸ƒå‡½æ•°é€‰æ‹©ç´¢å¼•
                    let index;
                    let attempts = 0;
                    do {
                        index = getDistributedIndex(options);
                        attempts++;
                        // å¦‚æœå°è¯•äº†å¾ˆå¤šæ¬¡è¿˜æ˜¯æ‰¾ä¸åˆ°æœªä½¿ç”¨çš„ç´¢å¼•ï¼Œå°±æ”¾å¼ƒæŸ¥æ‰¾
                        if (attempts > 20) break;
                    } while (usedIndices.has(index));
                    
                    if (!usedIndices.has(index)) {
                        usedIndices.add(index);
                        selected.push(options[index]);
                    }
                }
                
                return selected.join(multiSeparator);
            } else {
                return generateSingleValue();
            }
        }

        function generateRandomData() {
            const rowCount = parseInt(document.getElementById('rowCount').value) || 100;
            const config = {};
            fields.forEach(field => {
                config[field] = {
                    type: document.getElementById(`type_${field}`).value,
                    min: document.getElementById(`min_${field}`).value,
                    max: document.getElementById(`max_${field}`).value,
                    decimal: document.getElementById(`decimal_${field}`).value,
                    isMulti: document.getElementById(`multi_${field}`).checked
                };
            });

            let data = [];
            for(let i = 0; i < rowCount; i++) {
                const row = {};
                fields.forEach(field => {
                    row[field] = generateRandomValue(
                        config[field].type,
                        config[field].min,
                        config[field].max,
                        field,
                        config[field].isMulti,
                        config[field].decimal
                    );
                });
                data.push(row);
            }
            return data;
        }

        function previewData() {
            const loading = document.querySelector('.loading');
            loading.classList.add('active');

            setTimeout(() => {
                const data = generateRandomData();
                const previewContainer = document.getElementById('previewContainer');
                const table = document.getElementById('previewTable');
                const thead = table.querySelector('thead');
                const tbody = table.querySelector('tbody');

                // æ¸…ç©ºè¡¨æ ¼
                thead.innerHTML = '';
                tbody.innerHTML = '';

                // æ·»åŠ è¡¨å¤´
                const headerRow = document.createElement('tr');
                fields.forEach(field => {
                    const th = document.createElement('th');
                    th.textContent = field;
                    headerRow.appendChild(th);
                });
                thead.appendChild(headerRow);

                // æ·»åŠ æ•°æ®è¡Œï¼ˆæœ€å¤šæ˜¾ç¤º10è¡Œï¼‰
                const previewRows = data.slice(0, 10);
                previewRows.forEach(row => {
                    const tr = document.createElement('tr');
                    fields.forEach(field => {
                        const td = document.createElement('td');
                        td.textContent = row[field];
                        tr.appendChild(td);
                    });
                    tbody.appendChild(tr);
                });

                previewContainer.style.display = 'block';
                loading.classList.remove('active');
            }, 100);
        }

        function generateData() {
            const loading = document.querySelector('.loading');
            loading.classList.add('active');

            setTimeout(() => {
                const data = generateRandomData();
                const newWorkbook = XLSX.utils.book_new();
                const worksheet = XLSX.utils.json_to_sheet(data);
                XLSX.utils.book_append_sheet(newWorkbook, worksheet, "ç”Ÿæˆæ•°æ®");

                XLSX.writeFile(newWorkbook, "generated_data.xlsx");
                loading.classList.remove('active');
            }, 100);
        }

        // æ·»åŠ æ‹–æ”¾å¤„ç†
        const dropZone = document.getElementById('dropZone');

        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('drag-over');
        });

        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('drag-over');
        });

        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('drag-over');
            const file = e.dataTransfer.files[0];
            if (file && (file.name.endsWith('.xlsx') || file.name.endsWith('.xls'))) {
                document.getElementById('excelFile').files = e.dataTransfer.files;
                document.getElementById('excelFile').dispatchEvent(new Event('change'));
            }
        });

        // æ•°å­¦åˆ†å¸ƒå‡½æ•°
        function generateDistributedNumber(distribution, min, max, lambda = 1, mean = 0, stddev = 1, n = 10, p = 0.5, alpha = 2, beta = 2, decimal = 'auto') {
            // ç¡®ä¿minå’Œmaxä¸ºæ•°å­—
            min = parseFloat(min) || 0;
            max = parseFloat(max) || 100;
            
            // è®¡ç®—å‡å€¼å’Œæ ‡å‡†å·®
            // å¦‚æœæ²¡æœ‰æŒ‡å®šï¼Œåˆ™æ ¹æ®èŒƒå›´è®¡ç®—åˆç†çš„é»˜è®¤å€¼
            if (mean === 0) {
                mean = (min + max) / 2; // é»˜è®¤ä½¿ç”¨èŒƒå›´çš„ä¸­é—´å€¼ä½œä¸ºå‡å€¼
            }
            
            if (stddev === 1) {
                stddev = (max - min) / 6; // é»˜è®¤ä½¿ç”¨èŒƒå›´çš„1/6ä½œä¸ºæ ‡å‡†å·®ï¼ˆæ­£æ€åˆ†å¸ƒ68-95-99.7è§„åˆ™ï¼‰
                stddev = Math.max(1, stddev); // ç¡®ä¿è‡³å°‘ä¸º1
            }
            
            // lambdaå‚æ•°ä¹ŸåŸºäºèŒƒå›´
            if (lambda === 1) {
                lambda = 1 / ((max - min) / 10); // æ ¹æ®èŒƒå›´è®¾ç½®lambda
                lambda = Math.max(0.1, Math.min(10, lambda)); // é™åˆ¶lambdaèŒƒå›´
            }
            
            // è¾…åŠ©å‡½æ•°ï¼šç”Ÿæˆæ ‡å‡†æ­£æ€åˆ†å¸ƒéšæœºæ•°ï¼ˆBox-Mullerå˜æ¢ï¼‰
            const generateNormal = () => {
                const u1 = Math.random();
                const u2 = Math.random();
                const z0 = Math.sqrt(-2.0 * Math.log(u1)) * Math.cos(2.0 * Math.PI * u2);
                return z0;
            };
            
            // è¾…åŠ©å‡½æ•°ï¼šå°†å€¼é™åˆ¶åœ¨minå’Œmaxä¹‹é—´
            const clamp = (value) => Math.min(Math.max(value, min), max);

            // ç¡®ä¿minå’Œmaxæœ‰æ•ˆ
            if (!isFinite(min)) min = 0;
            if (!isFinite(max)) max = 100;
            if (min >= max) max = min + 10;

            let value;
            switch (distribution) {
                case 'uniform':
                    // å‡åŒ€åˆ†å¸ƒ
                    value = Math.random() * (max - min) + min;
                    break;
                
                case 'normal':
                    // æ­£æ€åˆ†å¸ƒ
                    value = mean + stddev * generateNormal();
                    break;
                
                case 'exponential':
                    // æŒ‡æ•°åˆ†å¸ƒ
                    value = min + (-Math.log(Math.random()) / lambda) * ((max - min) / 10);
                    break;
                
                case 'poisson':
                    // æ³Šæ¾åˆ†å¸ƒ (knuthç®—æ³•)
                    lambda = Math.max(1, lambda); // lambdaå¿…é¡»ä¸ºæ­£æ•°
                    let L = Math.exp(-lambda);
                    let k = 0;
                    let poisson_p = 1; // é‡å‘½åå˜é‡é¿å…ä¸å‡½æ•°å‚æ•°å†²çª
                    
                    do {
                        k++;
                        poisson_p *= Math.random();
                    } while (poisson_p > L);
                    
                    // å°†æ³Šæ¾ç»“æœç¼©æ”¾åˆ°èŒƒå›´å†…
                    value = min + (k - 1) * ((max - min) / (lambda * 2 + 5));
                    break;
                
                case 'binomial':
                    // äºŒé¡¹åˆ†å¸ƒ
                    n = Math.max(10, n);
                    let successes = 0;
                    
                    for (let i = 0; i < n; i++) {
                        if (Math.random() < p) {
                            successes++;
                        }
                    }
                    
                    // å°†äºŒé¡¹åˆ†å¸ƒç»“æœç¼©æ”¾åˆ°èŒƒå›´å†…
                    value = min + (successes / n) * (max - min);
                    break;
                
                case 'geometric':
                    // å‡ ä½•åˆ†å¸ƒ
                    const geo_p = Math.max(0.1, Math.min(p, 0.9)); // é¿å…æç«¯å€¼ï¼Œé‡å‘½åé¿å…å†²çª
                    const geoValue = Math.floor(Math.log(Math.random()) / Math.log(1 - geo_p));
                    value = min + (geoValue / 10) * (max - min);
                    break;
                
                case 'lognormal':
                    // å¯¹æ•°æ­£æ€åˆ†å¸ƒ
                    const logmean = Math.log((min + max) / 2); // ä½¿ç”¨ä¸­ç‚¹çš„å¯¹æ•°ä½œä¸ºå‡å€¼
                    const logstd = 0.5; // é€‚ä¸­çš„æ ‡å‡†å·®
                    value = Math.exp(logmean + logstd * generateNormal());
                    break;
                
                case 'pareto':
                    // å¸•ç´¯æ‰˜åˆ†å¸ƒ
                    alpha = Math.max(1, alpha); // alphaå¿…é¡»å¤§äº0
                    value = min * Math.pow(1 - Math.random() * 0.9, -1 / alpha); // é¿å…é™¤ä»¥é›¶
                    // ç¼©æ”¾åˆ°èŒƒå›´å†…
                    value = min + (value - min) * ((max - min) / Math.max(value, max));
                    break;
                
                case 'gamma':
                    // ä¼½é©¬åˆ†å¸ƒï¼ˆè¿‘ä¼¼ï¼‰
                    alpha = Math.max(1, alpha); // shape
                    let gammaValue = 0;
                    for (let i = 0; i < alpha; i++) {
                        gammaValue -= Math.log(Math.random());
                    }
                    value = min + (gammaValue / beta) * ((max - min) / 10);
                    break;
                
                case 'beta':
                    // è´å¡”åˆ†å¸ƒï¼ˆè¿‘ä¼¼ï¼‰
                    alpha = Math.max(1, alpha);
                    beta = Math.max(1, beta);
                    const x = generateGamma(alpha, 1);
                    const y = generateGamma(beta, 1);
                    const betaValue = x / (x + y);
                    value = min + betaValue * (max - min);
                    break;
                
                default:
                    // é»˜è®¤å‡åŒ€åˆ†å¸ƒ
                    value = Math.random() * (max - min) + min;
            }

            // æ ¹æ®ç±»å‹è¿”å›æ•´æ•°æˆ–æµ®ç‚¹æ•°ï¼Œå¤„ç†å°æ•°ä½æ•°
            // decimal: 'auto'(æ ¹æ®åˆ†å¸ƒç±»å‹), '0', '1', '2', '3', '4'
            if (decimal === '0') {
                // æ— å°æ•°ç‚¹
                return Math.round(clamp(value));
            } else if (decimal === '1' || decimal === '2' || decimal === '3' || decimal === '4') {
                // æŒ‡å®šå°æ•°ä½æ•°
                const decimalPlaces = parseInt(decimal);
                return parseFloat(clamp(value).toFixed(decimalPlaces));
            } else {
                // è‡ªåŠ¨æ¨¡å¼(æ ¹æ®åˆ†å¸ƒç±»å‹)
                if (distribution === 'uniform' || distribution === 'normal' || distribution === 'lognormal') {
                    // è¿™äº›åˆ†å¸ƒé€šå¸¸å¯ä»¥è¿”å›å°æ•°
                    return parseFloat(clamp(value).toFixed(2));
                } else {
                    // å…¶ä»–åˆ†å¸ƒé€šå¸¸è¿”å›æ•´æ•°
                    return Math.round(clamp(value));
                }
            }
        }
        
        // ä¼½é©¬åˆ†å¸ƒçš„è¾…åŠ©å‡½æ•°
        function generateGamma(alpha, beta) {
            if (alpha <= 0 || beta <= 0) {
                return NaN;
            }
            
            // å¯¹äºalpha < 1ï¼Œä½¿ç”¨Johnkçš„ç®—æ³•
            if (alpha < 1) {
                const u = Math.random();
                return generateGamma(alpha + 1, beta) * Math.pow(u, 1 / alpha);
            }
            
            // å¯¹äºalpha >= 1ï¼Œä½¿ç”¨Marsagliaå’ŒTsangç®—æ³•
            const d = alpha - 1/3;
            const c = 1 / Math.sqrt(9 * d);
            let v, x, u;
            
            do {
                do {
                    x = generateNormal();
                    v = 1 + c * x;
                } while (v <= 0);
                
                v = v * v * v;
                u = Math.random();
            } while (u > 1 - 0.331 * x * x * x * x && 
                    Math.log(u) > 0.5 * x * x + d * (1 - v + Math.log(v)));
            
            return d * v / beta;
        }
        
        // æ ‡å‡†æ­£æ€åˆ†å¸ƒç”Ÿæˆå™¨ï¼ˆBox-Mullerï¼‰
        function generateNormal() {
            let u = 0, v = 0;
            while (u === 0) u = Math.random();
            while (v === 0) v = Math.random();
            return Math.sqrt(-2.0 * Math.log(u)) * Math.cos(2.0 * Math.PI * v);
        }

        function addOptionInput(field, type) {
            let container;
            switch(type) {
                case 'text':
                    container = document.getElementById(`text_inputs_${field}`);
                    break;
                case 'email':
                    container = document.getElementById(`email_inputs_${field}`);
                    break;
                case 'province':
                    container = document.getElementById(`province_inputs_${field}`);
                    break;
                case 'city':
                    container = document.getElementById(`city_inputs_${field}`);
                    break;
                case 'district':
                    container = document.getElementById(`district_inputs_${field}`);
                    break;
                default:
                    return;
            }
            
            const newRow = document.createElement('div');
            newRow.className = 'option-input-row';
            
            let placeholder;
            switch(type) {
                case 'text':
                    placeholder = "è¯·è¾“å…¥é€‰é¡¹å€¼";
                    break;
                case 'email':
                    placeholder = "è¯·è¾“å…¥é‚®ç®±åç¼€ï¼Œå¦‚ï¼šgmail.com";
                    break;
                case 'province':
                    placeholder = "è¯·è¾“å…¥çœä»½";
                    break;
                case 'city':
                    placeholder = "è¯·è¾“å…¥åŸå¸‚";
                    break;
                case 'district':
                    placeholder = "è¯·è¾“å…¥åŒºåŸŸ";
                    break;
                default:
                    placeholder = "è¯·è¾“å…¥é€‰é¡¹";
            }
            
            newRow.innerHTML = `
                <input type="text" class="option-input" placeholder="${placeholder}"/>
                <button type="button" class="remove-option-btn" onclick="removeOptionInput(this)">Ã—</button>
            `;
            
            container.appendChild(newRow);
        }
        
        function removeOptionInput(button) {
            const row = button.parentElement;
            const container = row.parentElement;
            
            // ç¡®ä¿è‡³å°‘ä¿ç•™ä¸€ä¸ªé€‰é¡¹
            if (container.children.length > 1) {
                container.removeChild(row);
            } else {
                // å¦‚æœæ˜¯æœ€åä¸€ä¸ªï¼Œåˆ™æ¸…ç©ºå†…å®¹
                const input = row.querySelector('input');
                if (input) {
                    input.value = '';
                }
            }
        }
        
        // è·å–æŒ‡å®šç±»å‹çš„æ‰€æœ‰é€‰é¡¹å€¼
        function getOptionValues(field, type) {
            let container;
            switch(type) {
                case 'text':
                    container = document.getElementById(`text_inputs_${field}`);
                    break;
                case 'email':
                    container = document.getElementById(`email_inputs_${field}`);
                    break;
                case 'province':
                    container = document.getElementById(`province_inputs_${field}`);
                    break;
                case 'city':
                    container = document.getElementById(`city_inputs_${field}`);
                    break;
                case 'district':
                    container = document.getElementById(`district_inputs_${field}`);
                    break;
                default:
                    return [];
            }
            
            const inputs = container.querySelectorAll('.option-input');
            return Array.from(inputs)
                .map(input => input.value.trim())
                .filter(value => value); // è¿‡æ»¤ç©ºå€¼
        }
    </script>
</body>
</html>
